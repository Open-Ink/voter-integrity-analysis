SELECT DISTINCT '2023-07-31'::date         as INPUT_FILE_DATE,
                'NY'                       AS INPUT_STATE,
                IFF(NCOA.INPUT_COUNTYNAME = 'St.Lawrence',
                    'St Lawrence',
                    NCOA.INPUT_COUNTYNAME) AS INPUT_COUNTY,
                NCOA.INPUT_VOTER_ID        AS INPUT_VOTER_ID,
                NCOA.INPUT_LAST_NAME       AS INPUT_LAST_NAME,
                NCOA.INPUT_FIRST_NAME      AS INPUT_FIRST_NAME,
                NCOA.INPUT_MIDDLE_NAME     AS INPUT_MIDDLE_NAME,
                NCOA.INPUT_SUFFIX          AS INPUT_SUFFIX,
                NCOA.INPUT_ADDRESS_LINE1   AS INPUT_ADDRESS_LINE_1,
                NCOA.INPUT_ADDRESS_LINE2   AS INPUT_ADDRESS_LINE_2,
                NCOA.INPUT_CITY            AS INPUT_RESIDENCE_CITY,
                NCOA.INPUT_STATE           AS INPUT_RESIDENCE_STATE,
                NCOA.INPUT_ZIP_CODE5       AS INPUT_RESIDENCE_ZIPCODE,
                NCOA.HOUSEHOLD_POSITION,
                NCOA.NAME_ID,
                NCOA.INDIVIDUAL_RECORD_ID,
                NCOA.FIRST_NAME,
                NCOA.LAST_NAME,
                NCOA.COMPANY_NAME,
                NCOA.STREET_NUMBER,
                NCOA.STREET_PRE_DIRECTION,
                NCOA.STREET_NAME,
                NCOA.STREET_POST_DIRECTION,
                NCOA.STREET_SUFFIX,
                NCOA.UNIT_TYPE,
                NCOA.UNIT_NUMBER,
                NCOA.BOX_NUMBER,
                NCOA.CITY_NAME,
                NCOA.STATE_CODE,
                NCOA.POSTAL_CODE,
                NCOA.POSTAL_CODE_EXTENSION,
                NCOA.CARRIER_ROUTE,
                NCOA.ADDRESS_STATUS,
                NCOA.ERROR_NUMBER,
                NCOA.ADDRESS_TYPE,
                NCOA.DELIVERY_POINT,
                NCOA.CHECK_DIGIT,
                NCOA.DELIVERY_POINT_VERIFICATION,
                NCOA.DELIVERY_POINT_VERIFICATION_NOTES,
                NCOA.VACANT,
                NCOA.CONGRESSIONAL_DISTRICT_CODE,
                NCOA.AREA_CODE,
                NCOA.LATITUDE,
                NCOA.LONGITUDE,
                NCOA.TIME_ZONE,
                NCOA.COUNTY_NAME,
                NCOA.COUNTY_FIPS,
                NCOA.STATE_FIPS,
                NCOA.BARCODE,
                NCOA.LOCATABLE_ADDRESS_CONVERSION_SYSTEM,
                NCOA.LINE_OF_TRAVEL,
                NCOA.ASCENDING_OR_DESCENDING,
                NCOA.MOVE_APPLIED,
                NCOA.MOVE_TYPE,
                NCOA.MOVE_DATE,
                NCOA.MOVE_DISTANCE,
                NCOA.MATCH_FLAG,
                NCOA.NXI,
                NCOA.ANK,
                NCOA.RESIDENTIAL_DELIVERY_INDICATOR,
                NCOA.RECORD_TYPE,
                NCOA.COUNTRY_CODE,
                NCOA.ADDRESS_LINE_1,
                NCOA.ADDRESS_LINE_2,
                NCOA.ADDRESS_ID,
                NCOA.HOUSEHOLD_ID,
                NCOA.INDIVIDUAL_ID
FROM RAW.NEW_YORK_NCOA_RESULTS_2023_09_20 NCOA
         INNER JOIN {{ ref("new_york_voters") }} V ON NCOA.INPUT_VOTER_ID = V.VOTER_ID
    AND UPPER(REPLACE(MERGE_ADDRESS_ELEMENTS([
        NCOA.INPUT_ADDRESS_LINE1,
        NCOA.INPUT_ADDRESS_LINE2,
        NCOA.INPUT_ZIP_CODE5
        ]), ' ', '')) = V.UNIQUE_ID
    AND NCOA.INPUT_VOTER_ID NOT IN (
                                    'NY000000000022704274',
                                    'NY000000000053764904',
                                    'NY000000000037135509',
                                    'NY000000000038037707',
                                    'NY000000000037224350',
                                    'NY000000000037594247',
                                    'NY000000000037465236',
                                    'NY000000000054520976',
                                    'NY000000000037892323',
                                    'NY000000000022592629',
                                    'NY000000000052822077',
                                    'NY000000000054289529',
                                    'NY000000000037780716',
                                    'NY000000000037893454',
                                    'NY000000000037771799',
                                    'NY000000000035652286',
                                    'NY000000000037929514',
                                    'NY000000000050381008',
                                    'NY000000000037910728',
                                    'NY000000000034884031',
                                    'NY000000000036286704',
                                    'NY000000000034729033',
                                    'NY000000000037529297',
                                    'NY000000000037911976',
                                    'NY000000000037596418',
                                    'NY000000000038240968',
                                    'NY000000000057661775',
                                    'NY000000000037403834',
                                    'NY000000000040014297',
                                    'NY000000000053248441'
        )