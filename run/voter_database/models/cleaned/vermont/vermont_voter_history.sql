
  create or replace   view DBT_VOTER_DATA.cleaned.vermont_voter_history
  
   as (
    WITH ELECTION_HISTORY AS
         (SELECT VOTER_ID,
                 COUNTY,
                 GEN_ELECTION_PARTICIPATION_2022,
                 NEXT_DAY('2022-11-01', 'tu') AS ELECTION_DATE
          FROM RAW.VERMONT_VOTERS_2023_09_27
          WHERE GEN_ELECTION_PARTICIPATION_2022 = 'T'
          UNION
          SELECT VOTER_ID, COUNTY, GEN_ELECTION_PARTICIPATION_2020, NEXT_DAY('2020-11-01', 'tu')
          FROM RAW.VERMONT_VOTERS_2023_09_27
          WHERE GEN_ELECTION_PARTICIPATION_2020 = 'T'
          UNION
          SELECT VOTER_ID, COUNTY, GEN_ELECTION_PARTICIPATION_2018, NEXT_DAY('2018-11-01', 'tu')
          FROM RAW.VERMONT_VOTERS_2023_09_27
          WHERE GEN_ELECTION_PARTICIPATION_2018 = 'T'
          UNION
          SELECT VOTER_ID, COUNTY, GEN_ELECTION_PARTICIPATION_2016, NEXT_DAY('2016-11-01', 'tu')
          FROM RAW.VERMONT_VOTERS_2023_09_27
          WHERE GEN_ELECTION_PARTICIPATION_2016 = 'T'
          UNION
          SELECT VOTER_ID, COUNTY, GEN_ELECTION_PARTICIPATION_2014, NEXT_DAY('2014-11-01', 'tu')
          FROM RAW.VERMONT_VOTERS_2023_09_27
          WHERE GEN_ELECTION_PARTICIPATION_2014 = 'T'
          UNION
          SELECT VOTER_ID, COUNTY, GEN_ELECTION_PARTICIPATION_2012, NEXT_DAY('2012-11-01', 'tu')
          FROM RAW.VERMONT_VOTERS_2023_09_27
          WHERE GEN_ELECTION_PARTICIPATION_2012 = 'T'
          UNION
          SELECT VOTER_ID, COUNTY, GEN_ELECTION_PARTICIPATION_2010, NEXT_DAY('2010-11-01', 'tu')
          FROM RAW.VERMONT_VOTERS_2023_09_27
          WHERE GEN_ELECTION_PARTICIPATION_2010 = 'T'
          UNION
          SELECT VOTER_ID, COUNTY, GEN_ELECTION_PARTICIPATION_2008, NEXT_DAY('2008-11-01', 'tu')
          FROM RAW.VERMONT_VOTERS_2023_09_27
          WHERE GEN_ELECTION_PARTICIPATION_2008 = 'T')
SELECT 'VT'             AS STATE_CODE,
       VH.COUNTY        AS COUNTY_CODE,
       VH.VOTER_ID      AS VOTER_ID,
       VH.ELECTION_DATE AS ELECTION_DATE,
       NULL             AS PARTY_VOTED,
       'UNKNOWN'        AS VOTING_METHOD,
       NULL             AS DATE_OF_VOTING,
       TRUE             AS WAS_VOTE_COUNTED,
       NULL::object     AS ADDITIONAL_DATA,
       'GENERAL'        AS ELECTION_TYPE
FROM ELECTION_HISTORY VH
  );

