
  create or replace   view DBT_VOTER_DATA.cleaned.utah_voter_history
  
   as (
    WITH VOTER_HISTORY AS
         (SELECT VOTER_ID, ELECTION_11_21_2023, 'GENERAL' AS ELECTION_TYPE, '2023-11-21' AS ELECTION_DATE
          FROM RAW.UTAH_VOTER_HISTORY_2023_11_06
          WHERE ELECTION_11_21_2023 IS NOT NULL
          UNION
          SELECT VOTER_ID, ELECTION_09_05_2023, 'PRIMARY', '2023-09-05'
          FROM RAW.UTAH_VOTER_HISTORY_2023_11_06
          WHERE ELECTION_09_05_2023 IS NOT NULL
          UNION
          SELECT VOTER_ID, ELECTION_11_08_2022, 'GENERAL', '2022-11-08'
          FROM RAW.UTAH_VOTER_HISTORY_2023_11_06
          WHERE ELECTION_11_08_2022 IS NOT NULL
          UNION
          SELECT VOTER_ID, ELECTION_06_28_2022, 'PRIMARY', '2022-06-28'
          FROM RAW.UTAH_VOTER_HISTORY_2023_11_06
          WHERE ELECTION_06_28_2022 IS NOT NULL
          UNION
          SELECT VOTER_ID, ELECTION_11_03_2020, 'GENERAL', '2020-11-03'
          FROM RAW.UTAH_VOTER_HISTORY_2023_11_06
          WHERE ELECTION_11_03_2020 IS NOT NULL
          UNION
          SELECT VOTER_ID, ELECTION_06_30_2020, 'PRIMARY', '2020-06-30'
          FROM RAW.UTAH_VOTER_HISTORY_2023_11_06
          WHERE ELECTION_06_30_2020 IS NOT NULL
          UNION
          SELECT VOTER_ID, ELECTION_03_03_2020, 'PRESIDENTIAL PRIMARY', '2020-03-03'
          FROM RAW.UTAH_VOTER_HISTORY_2023_11_06
          WHERE ELECTION_03_03_2020 IS NOT NULL
          UNION
          SELECT VOTER_ID, ELECTION_11_06_2018, 'GENERAL', '2018-11-06'
          FROM RAW.UTAH_VOTER_HISTORY_2023_11_06
          WHERE ELECTION_11_06_2018 IS NOT NULL
          UNION
          SELECT VOTER_ID, ELECTION_06_26_2018, 'PRIMARY', '2018-06-26'
          FROM RAW.UTAH_VOTER_HISTORY_2023_11_06
          WHERE ELECTION_06_26_2018 IS NOT NULL
          UNION
          SELECT VOTER_ID, ELECTION_11_08_2016, 'GENERAL', '2016-11-08'
          FROM RAW.UTAH_VOTER_HISTORY_2023_11_06
          WHERE ELECTION_11_08_2016 IS NOT NULL
          UNION
          SELECT VOTER_ID, ELECTION_06_28_2016, 'PRIMARY', '2016-06-28'
          FROM RAW.UTAH_VOTER_HISTORY_2023_11_06
          WHERE ELECTION_06_28_2016 IS NOT NULL)
SELECT 'UT'                AS STATE_CODE,
       V.COUNTY            AS COUNTY_CODE,
       VH.VOTER_ID         AS VOTER_ID,
       ELECTION_TYPE       AS ELECTION_TYPE,
       ELECTION_DATE::date AS ELECTION_DATE,
       NULL                AS PARTY_VOTED,
       'UNKNOWN'           AS VOTING_METHOD,
       NULL                AS DATE_OF_VOTING,
       TRUE                AS WAS_VOTE_COUNTED,
       NULL::object        AS ADDITIONAL_DATA
FROM VOTER_HISTORY VH
         INNER JOIN RAW.UTAH_VOTERS_2023_11_06 V ON V.VOTER_ID = VH.VOTER_ID
  );

